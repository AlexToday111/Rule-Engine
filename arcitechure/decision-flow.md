# Поток принятия решения

Ниже описан детальный алгоритм работы `DecisionService`.

1) Получение входного запроса `DecisionRequest`.
2) Загрузка списка правил по `decisionType` через `RuleCache` (если кэш устарел — чтение из БД).
3) Создание `DecisionContext` с атрибутами запроса.
4) Установка решения по умолчанию: `ALLOW`.
5) Последовательная обработка правил по `priority` (возрастание):
   - `condition` разбивается по `&&` на простые выражения.
   - Поддерживаются операции: `==`, `!=`, `>`, `>=`, `<`, `<=`.
   - Для чисел допускаются сравнения всех операторов, для строк — только `==`/`!=`.
6) Для каждого правила формируется запись трассировки `triggeredRules`.
7) При совпадении:
   - парсится `effect` (ALLOW/DENY/REVIEW + reason),
   - результат записывается в ответ,
   - при `DENY` вычисление прекращается,
   - при `REVIEW` вычисление продолжается.
8) В ответе возвращается решение, трассировка и время выполнения.

Ошибки синтаксиса условия приводят к `ConditionSyntaxException` и ответу HTTP 400.
